---
title: "Data Tidying"
output: Tidy Dataset
---

This is an [R Markdown](http://garrettgman.github.io/tidying/) Notebook. “tidy data,” a way to organize your data that works particularly well with R. 
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.



## Package Creatation
```{r}

# Loading required package: 
install.packages("usethis")
install.packages(c("devtools", "roxygen2", "testthat", "knitr", "tidyr", "dplyr", "ggplot2"))

#devtools::install_github("tidyverse/forcats")
devtools::install_github("garrettgman/DSR",force = TRUE)
library(usethis)
library(devtools)
library(roxygen2)
library(testthat)
library(tidyr)
library(DSR)

# version of devtools?
# packageVersion("devtools")
# devtools::session_info()


```

```{r}
getwd()

devtools::create("/Users/leilayousefi/LeilaDocuments/git/MoJ/TidyData/DataTidying")
```

## Git Repo
cd DataTidying 
git status 
git add . -n
git add .
git commit -m "created package in R" 
git status 
git push



## Create new issue in github:
# name the issue: Add sensitive file to gitignore

git status
git branch
git pull

git branch fix/3
git checkout fix/3
(git checkout -b fix/3)

vim sensitive.txt

cmd(ctrl)+i
secrets

before and wish to exit a session without saving your changes, press Esc then type :q! and hit Enter or ↵ or on Macs, Return . If you want to save your changes and quit, press Esc then type :wq and hit Enter or ↵ or on Macs, Return .

ESC
:wq #(for saving the changes and file)
:q! 

ls -a
git status
git add . -n
git add .
git commit -m "Added sensitive file in gitignore"

ls -a
vim .gitignore
add sensitive.txt to it 
ESC
:wq

(or add the sensitive.txt through Rstadio)

git push origin fix/3 -u
git push


## goto github:
compare and pull request
Add reviewers and assignee
after their review 
merge
confirm

==> you cannot see sensitive.txt on the cloud github

## look at https://github.com/ukgovdatascience/dotfiles for more information on sensitive files and implement it on your system for the privacy of sensitive information before get push on Github and the cloud
Often you will work on projects with sensitive data or analyses; you need a way to prevent these files from being published on Github. Fortunately, you can do this using .gitignore as well as other advanced tools like githooks.

Type git status in the command line.

Now add SECRET.*  to .gitignore 

Type git status  again.

What happens?

Questions for this assignment
How could you use your .gitignore file to protect yourself against accidentally committing sensitive data? Do you have a boiler plate .gitignore template to use?

git clone https://github.com/ukgovdatascience/dotfiles
cd dotfiles

## Copy the file into the root of a git repository and edit as approproate.

## Set as .gitignore_global
To use for ALL git repos, the template can be set globally. Note that this is likely to be very annoying in its current form, so should be edited as appropriate, otherwise trivial files are likely to be invisible to git. Even ignored files can be added with git add -f, however you need to realise that they are being ignored!

cp .gitignore ~/.gitignore_global
git config --global core.excludesfile ~/.gitignore_global

## set this as the .gitignore_global, you can exclude individual repositories by running:

git config --local --unset core.excludesfile

## The above can be used with --global to stop using it as the global .gitignore.

More information about ignoring files can be found here: https://help.github.com/articles/ignoring-files/


pre-commit and pre-push hooks
These hooks will check, at the point of each commit and push, that the the code does not contain any of the following:

AWS keys (determined by regex)
Private SSH keys (determined by regex)
.pem files
Various data formats:
xls, xlsx, xlsm, xlst,
csv, txt,
sav,
db, sqlite,
feather, pkl, pickle,
ods, gsheet,
Rdata, Rds
ipython/jupyer notebooks (ipynb)
Install in all new repositories
** Note that this will overwrite any prior pre-commit and pre-push hooks you may have already installed**

cp -r git_template ~/.git_template

git config --global init.templatedir '~/.git_template'

## Install into any pre-existing repositories
Having done the previous step, run the following to sync git hooks with the defaults in ~/.git_template:

$(git config --path --get init.templatedir)/update.sh
Install all pre-existing repositories in a directory
The following code will cycle through all directories in a folder (assuming they are all managed by git), and install the default hooks into each of them:

current=$(pwd); for i in $(ls .); do echo $i; cd $i ; $(git config --path --get init.templatedir)/update.sh; cd $current done

## create a new branch for data
create a new directory (raw-data)
add the csv file to it

git pull
cd data-raw 
ls -a

git status

git checkout -b feature/data
ls

git status

cd ../
ls




```{r}
devtools::check()
regreg <- read.csv('./data-raw/register.csv', header = TRUE)

#regreg <- readr::read_csv("./data-raw/register.csv")
devtools::use_data(regreg)
```






## tidy data and clean it and then convert raw data to a nice R object of the minimal tidy data set.

This section introduces “tidy data,” a way to organize your data that works particularly well with R.

squashed your commits and pushed to Github and created a pull request for your RAP buddy to review

```{r}



```

## making untidy data tidy
reorganize the values in your data set with the the spread() and gather() functions of the tidyr package.

```{r}
library(DSR)
# Data set one
table1

# Data set two
table2

# Data set three
table3

# Data set four
table4  # cases

table5  # population


```

```{r}
mean(table1$cases)
table1$cases / table1$population * 10000
```

Each variable in the data set is placed in its own column
Each observation is placed in its own row
Each value is placed in its own cell*

## split apart and combine values in your data set to make them easier to access with R

```{r}

library(tidyr)
spread(table2, key, value)
```

## R factors
R uses factors to handle categorical variables, variables that have a fixed and known set of possible values. Factors are also helpful for reordering character vectors to improve display. The goal of the forcats package is to provide a suite of tools that solve common problems with factors, including changing the order of levels or the values. Some examples include:

fct_reorder(): Reordering a factor by another variable.
fct_infreq(): Reordering a factor by the frequency of values.
fct_relevel(): Changing the order of a factor by hand.
fct_lump(): Collapsing the least/most frequent values of a factor into “other”.
You can learn more about each of these in vignette("forcats"). If you’re new to factors, the best place to start is the chapter on factors in R for Data Science.

```{r}
library(forcats)
library(dplyr)
library(ggplot2)

print(starwars)

starwars %>% 
  filter(!is.na(species)) %>%
  count(species, sort = TRUE)

starwars %>%
  filter(!is.na(species)) %>%
  mutate(species = fct_lump(species, n = 3)) %>%
  count(species)

ggplot(starwars, aes(x = eye_color)) + 
  geom_bar() + 
  coord_flip()

starwars %>%
  mutate(eye_color = fct_infreq(eye_color)) %>%
  ggplot(aes(x = eye_color)) + 
  geom_bar() + 
  coord_flip()
```


## combining everything you’ve learned about tidyr to tidy a real data set on tuberculosis epidemiology collected by the World Health Organization.
